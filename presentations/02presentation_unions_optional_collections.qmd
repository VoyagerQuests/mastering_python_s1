---
title: "Unions, Optional and Collection Type ABCs"
format:
  revealjs:
    width: 1600
    height: 1200
    margin: 0.1
    css: styles.css
    transition: slide
    transition-speed: fast
    execute:
      echo: true
      ansi: false
      error: true
theme: dark
---
```{python}
#| include: false
%xmode Plain
```

## {auto-animate=true}
<h2 data-id="title">What is this functionâ€™s expected type?</h2>

```{python}
def total_character_count(words):
    total = 0
    for char in words:
        total += len(char)
    return total
```

## {auto-animate=true}
<h2 data-id="title">No IDE guidance on correct usage</h2>

```{python}
def total_character_count(words):
    total = 0
    for char in words:
        total += len(char)
    return total

print(
    "Total character count: ",
    total_character_count("Flee you fools! You shall not pass!") 
) 

```

## {auto-animate=true}
<h2 data-id="title">No IDE guidance on correct usage</h2>

```{.python}
def total_character_count(words):
    total = 0
    for char in words:
        total += len(char)
    return total

print(
    "Total character count: ",
    total_character_count(["Flee ", "you ", "fools! ",
                        "You ", "shall ", "not ", "pass!"]), 
) 

```

## {auto-animate=true}
<h2 data-id="title">No IDE guidance on correct usage</h2>

```{python}
def total_character_count(words):
    total = 0
    for char in words:
        total += len(char)
    return total

print(
    "Total character count: ",
    total_character_count(["Flee ", "you ", "fools! ",
                        "You ", "shall ", "not ", "pass!"]), 
) 

```

## {auto-animate=true}
<h2 data-id="title">No IDE guidance on correct usage</h2>

```{.python}
def total_character_count(words):
    total = 0
    for char in words:
        total += len(char)
    return total

print( # <1>
    "Total character count: ",
    total_character_count([("Flee ", "you ", "fools! "),
                        ("You ", "shall ", "not ", "pass!")]), 
) 
```
1. Is this a valid function call?

## {auto-animate=true}
<h2 data-id="title">No warnings - issues appear only when executed</h2>

```{python}
def total_character_count(words):
    total = 0
    for char in words:
        total += len(char)
    return total

print("Total character count: ",
     total_character_count([("Flee","you","fools!"),("You","shall","not","pass!")])) # <1>
```
1. No type hint is shown!

## {auto-animate=true}
<h2 data-id="title">Intput: string OR a list of strings and returns an integer</h2>

```{python}
#| code-line-numbers: "|1"

def total_character_count(words: str | list[str]) -> int:
    total = 0
    for char in words:
        total += len(char)
    return total
```

## {auto-animate=true}
<h2 data-id="title">Type checker now gives a clear warning</h2>

```{python}
def total_character_count(words: str | list[str]) -> int:
    total = 0
    for char in words:
        total += len(char)
    return total

print(
    "Total character count: ",
    total_character_count("Flee you fools! You shall not pass!") 
) 

print(
    "Total character count: ",
    total_character_count(["Flee ", "you ", "fools! ",
                        "You ", "shall ", "not ", "pass!"]), 
) 

print( # <1>
    "Total character count: ",
    total_character_count([("Flee ", "you ", "fools! "),
                        ("You ", "shall ", "not ", "pass!")]), 
) 
```
1. Argument of type "list[str | tuple[str, str, str, str]]" cannot be assigned to parameter "words" of type "str | list[str]"

## {auto-animate="true"}

<h2 data-id="title">Type checker now gives a clear warning</h2>


<img src="images/type_complaint.png"
     style="width:90%; display:block; margin:auto;" />

## {auto-animate="true"}

<h2 data-id="title">Clear type guidance</h2>

<img src="images/type_hinting.png"
     style="width:75%; display:block; margin:auto;" />

## {auto-animate="true"}
<h2 data-id="title">Safe and flexible functions with clear contracts</h2>


``` {python}
#| code-line-numbers: ""
def total_character_count(words: str | list[str]) -> int:
    total = 0
    for char in words:
        total += len(char)
    return total
```
<h3 data-id="title">Let's make it more flexible!</h2>

## {auto-animate="true"}
<h2 data-id="title">Refactoring to be more usable</h2>


``` {python}
#| code-line-numbers: "1-2|3|"
from collections.abc import Iterable

def total_character_count(words: Iterable[str]) -> int:
    total = 0
    for char in words:
        total += len(char)
    return total
```

## {auto-animate="true"}
<h2 data-id="title">The magic of type hints / annotations!</h2>

``` {python}
from collections.abc import Iterable

def total_character_count(words: Iterable[str]) -> int:
    total = 0
    for char in words:
        total += len(char)
    return total

print("Count: ",total_character_count(["Hello", " world!"]))  # list of strings
print("Count: ",total_character_count(("Hello", " world!")))  # tuple of strings
print("Count: ",total_character_count({"Hello", " world!"}))  # set of strings
print("Count: ",total_character_count(word for word in ["Hello", " world!"])) # generator yielding strings
print("Count: ",total_character_count(iter(["Hello", " world!"]))) # iterator of strings
print("Count: ",total_character_count("Hello world!"))  
print("Count: ",total_character_count([("Hello"," world!")])) # <1>
```
1. Argument of type "Literal[12345]" cannot be assigned to parameter "words" of type "Iterable[str]"

## {auto-animate="true"}
<h2 data-id="title">Unions, Optional and Collection Types</h2>

``` {python}
#| code-line-numbers: "1-6|1-3|4|5|6|8-11|13-14|16-17|19-20|22-23|25-26|"
# Unions and Optional

value: int | str = 42
name: str | None = None 
words: str | list[str] = ["hello", "world"]
mixed: list[str | int] = ["a", 1]

# Collection Type ABCs

from collections.abc import Iterable
words: Iterable[str] = ("a", "b")

from collections.abc import Iterator
it: Iterator[int] = iter([1, 2, 3])

from collections.abc import Sequence
seq: Sequence[str] = ["a", "b"]

from collections.abc import Collection
c: Collection[int] = {1, 2, 3}

from collections.abc import Container
c: Container[str] = {"a", "b"}

from collections.abc import Reversible
r: Reversible[int] = [1, 2, 3]

```
